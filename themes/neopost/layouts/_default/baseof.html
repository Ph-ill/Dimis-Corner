<!DOCTYPE html>
<html lang="{{ .Site.Language }}">
<head>
    <title>{{ if not .IsHome }}{{ .Title }} | {{ end }}{{ .Site.Title }}</title>
    <link rel="canonical" href="{{ .Site.BaseURL }}">
    
    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
    <link rel="manifest" href="/favicon/site.webmanifest">
    <link rel="shortcut icon" href="/favicon/favicon.ico">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
    
    <meta name="description" content="{{ with .Params.description }}{{ . }}{{ else }}{{ .Summary }}{{ end }}">
    
    {{ if isset .Params "tags" }}
    <meta name="keywords" content="{{ with .Params.tags }}{{ delimit . ", " }}{{ end }}">
    {{ end }}
    
    {{ partial "style.html" . }}
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="index, follow">
    <meta charset="utf-8">
    <script>
        // Dynamic random background tile selector
        document.addEventListener('DOMContentLoaded', function() {
            const backgroundTiles = [
                {{- $bgTilesDir := "bg_tiles" -}}
                {{- range $path := (readDir (printf "static/%s" $bgTilesDir)) -}}
                {{- if not .IsDir -}}
                {{- $ext := path.Ext .Name | lower -}}
                {{- if or (eq $ext ".jpg") (eq $ext ".jpeg") (eq $ext ".png") (eq $ext ".gif") (eq $ext ".webp") (eq $ext ".bmp") -}}
                '/{{ $bgTilesDir }}/{{ .Name }}',
                {{- end -}}
                {{- end -}}
                {{- end -}}
            ];
            
            // Only proceed if we have background tiles
            if (backgroundTiles.length > 0) {
                // Select a random background
                const randomBg = backgroundTiles[Math.floor(Math.random() * backgroundTiles.length)];
                
                // Apply the background to the body
                document.body.style.backgroundImage = `url(${randomBg})`;
                document.body.style.backgroundRepeat = 'repeat';
                document.body.style.backgroundAttachment = 'fixed';
            }
        });
    </script>
    
    <!-- Dynamic Title System -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap');
        
        #dynamic-title {
            background-color: var(--bg-color2);
            margin: 0 auto;
            font-size: 6em;
            max-width: 60rem;
            padding: 12px 24px;
            border-radius: 0.3em;
            border: 4px double var(--outline-color);
            text-align: center;
            position: relative;
            display: block;
            width: fit-content;
        }
        
        #dynamic-title a {
            position: relative;
            display: inline-block;
            text-decoration: none;
            color: inherit;
        }
        
        #title-shadow {
            position: absolute;
            top: 3px;
            left: 3px;
            color: #000000;
            z-index: 1;
            pointer-events: none;
            width: 100%;
            white-space: nowrap;
        }
        
        #title-text {
            position: relative;
            z-index: 2;
            white-space: nowrap;
        }
        
        .dynamic-letter {
            display: inline-block;
        }
        
        .font-comic { font-family: 'Comic Neue', cursive !important; }
        .font-times { font-family: 'Times New Roman', Times, serif !important; }
        .font-biz { font-family: 'BIZ UDMincho', serif !important; }
        
        /* Override default h1 styling for our dynamic title */
        header > #dynamic-title {
            filter: none !important;
            color: inherit !important;
        }
    </style>
    
    <script>
        // Dynamic Title System
        document.addEventListener('DOMContentLoaded', function() {
            const titleColors = [
                '#41BEDB', // Bright blue
                '#EB7DDA', // Pink/magenta  
                '#FFAFDB', // Light pink
                '#FFFF63', // Bright yellow
                '#E2E2E2'  // Light gray
            ];
            
            const titleFonts = [
                'font-comic',
                'font-times', 
                'font-biz'
            ];
            
            function getRandomFont() {
                return titleFonts[Math.floor(Math.random() * titleFonts.length)];
            }
            
            function getRandomColor(excludeColor = null) {
                let availableColors = titleColors.filter(color => color !== excludeColor);
                return availableColors[Math.floor(Math.random() * availableColors.length)];
            }
            
            function generateTitleStyling() {
                const shadowElement = document.getElementById('title-shadow');
                const textElement = document.getElementById('title-text');
                
                if (!shadowElement || !textElement) return;
                
                const titleText = shadowElement.textContent;
                let shadowHTML = '';
                let textHTML = '';
                let lastColor = null;
                
                // Choose ONE random font for the entire title
                const titleFont = getRandomFont();
                
                for (let i = 0; i < titleText.length; i++) {
                    const char = titleText[i];
                    
                    if (char === ' ') {
                        shadowHTML += ' ';
                        textHTML += ' ';
                        continue;
                    }
                    
                    const randomColor = getRandomColor(lastColor);
                    lastColor = randomColor;
                    
                    // Shadow version (black, same font for all)
                    shadowHTML += `<span class="dynamic-letter ${titleFont}" style="color: #000000;">${char}</span>`;
                    
                    // Main text version (colorful, same font for all)
                    textHTML += `<span class="dynamic-letter ${titleFont}" style="color: ${randomColor};">${char}</span>`;
                }
                
                shadowElement.innerHTML = shadowHTML;
                textElement.innerHTML = textHTML;
            }
            
            // Generate synchronized styling for both shadow and main text
            generateTitleStyling();
        });
    </script>
</head>
<body>
        <header><h1 id="dynamic-title"><a href="/"><span id="title-shadow">{{ .Site.Title }}</span><span id="title-text">{{ .Site.Title }}</span></a></h1></header>
<main>
    {{ block "main" . }}{{ end }}
    {{ if .Param "nextprev" }}{{ partial "nextprev.html" . }}{{ end }}
</main>
</body>
</html>
