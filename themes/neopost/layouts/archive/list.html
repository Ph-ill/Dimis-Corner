{{ define "main" }}
    {{ if .IsTranslated }}
    <nav class="languages links">
        <ul>
        {{ range .Translations }}
        <li>
            <a href="{{ .RelPermalink }}">{{ or (.Language.LanguageName) (.Language.Lang) }}</a>
        </li>
        {{ end }}
        </ul>
    </nav>
    {{ end }}
    <div id="content">
    <aside id="sidebar">
        <div id="avatar">
            {{ with .Site.GetPage "section" "/sidebar/_index.md" }}
            <img class="flower" src="{{ index .Params "icon-path" }}">
            {{ end }}
        </div>
        
        <div id="bio">
        {{ with .Site.GetPage "section" "/sidebar/bio.md" }}
            {{ .Content | safeHTML }}
        {{ end }}
        </div>
        
        <div class="small-box">
            {{ with .Site.GetPage "section" "/sidebar/basic-info.md" }}
                {{ .Content | safeHTML }}
            {{ end }}
            </ul>
        </div>

        {{ if .Site.Params.sidebar.tags.enable }}
        <div>
            <div class="tags">
                <p class="tags">Tags</p>
            </div>

            <ul class="tags">
            {{ $tags_limit := (or (index .Site.Params.sidebar.tags "limit") 5) }}
            {{ $more_tags_text := (or (index .Site.Params.sidebar.tags "more-text") "more tags...") }}
            {{ $tags := .Site.Taxonomies.tags | sort }}
            {{ range $tags | first $tags_limit }}<li><a href="{{ .Page.Permalink }}">{{ .Page.Title }}</a></li>{{ end }}
            </ul>
            {{ if gt (len $tags) $tags_limit }}
            <div class="tags">
                <a href="{{ relLangURL (printf "/tags") }}"><b>{{ $more_tags_text }}</b></a>
            </div>
        </div>
        {{ end }}
        {{ end }}
        
        <nav class="links">
            <ul>
            {{ with .Site.GetPage "section" "/sidebar/_index.md" }}
            {{ range .Params.links }}
                <li><a href="{{ .link }}">{{ .name }}</a></li>
            {{ end }}
            {{ end }}
            </ul>
        </nav>
    </aside>
    <main>
        <article>
            <h1>{{ .Title }}</h1>
            <div class="post-content">
                {{ .Content }}
            </div>
            
            <!-- Archive organized by year and month -->
            {{ $posts := where .Site.RegularPages "Section" "posts" }}
            {{ $postsByYear := $posts.GroupByDate "2006" }}
            
            {{ if gt (len $postsByYear) 0 }}
                <div class="archive-years">
                    {{ range $postsByYear }}
                        {{ $year := .Key }}
                        {{ $yearPosts := .Pages }}
                        
                        <!-- Year header with link to year archive -->
                        <div class="archive-year-section">
                            <h2 class="archive-year">
                                <a href="/archive/{{ $year | lower }}/">{{ $year }}</a>
                                <span class="post-count">({{ len $yearPosts }} {{ if eq (len $yearPosts) 1 }}post{{ else }}posts{{ end }})</span>
                            </h2>
                            
                            <!-- Month breakdown for this year -->
                            {{ $postsByMonth := $yearPosts.GroupByDate "January" }}
                            <div class="archive-months">
                                {{ range $postsByMonth }}
                                    {{ $month := .Key }}
                                    {{ $monthPosts := .Pages }}
                                    <div class="archive-month">
                                        <a href="/archive/{{ $year | lower }}/{{ $month | lower }}/">
                                            {{ $month }} ({{ len $monthPosts }})
                                        </a>
                                    </div>
                                {{ end }}
                            </div>
                        </div>
                    {{ end }}
                </div>
            {{ else }}
                <div class="archive-empty">
                    <p>No posts found.</p>
                </div>
            {{ end }}
        </article>
    </main>
    </div>
    
    <style>
        .archive-years {
            margin-top: 2rem;
        }
        
        .archive-year-section {
            margin-bottom: 3rem;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 1.5rem;
        }
        
        .archive-year-section:last-child {
            border-bottom: none;
        }
        
        .archive-year {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: var(--special-text-color);
        }
        
        .archive-year a {
            text-decoration: none;
            color: var(--link-color);
            font-weight: bold;
        }
        
        .archive-year a:hover {
            color: var(--accent-color);
        }
        
        .post-count {
            font-size: 1rem;
            font-weight: normal;
            color: var(--text-color);
            margin-left: 0.5rem;
        }
        
        .archive-months {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-left: 1rem;
        }
        
        .archive-month a {
            display: inline-block;
            padding: 0.5rem 1rem;
            background-color: var(--bg-color2);
            color: var(--link-color);
            text-decoration: none;
            border: 2px solid var(--border-color);
            border-radius: 0.3rem;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }
        
        .archive-month a:hover {
            background-color: var(--select-color);
            color: var(--accent-color);
            border-color: var(--accent-color);
        }
        
        .archive-empty {
            text-align: center;
            padding: 2rem;
            color: var(--text-color);
        }
    </style>
{{ end }}
